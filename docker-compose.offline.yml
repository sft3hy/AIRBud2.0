services:
  # 1. Parser Service Override
  parser:
    build:
      context: .
      dockerfile: services/parser/Dockerfile.offline
    # No volumes needed for models anymore
    environment:
      - OFFLINE_MODEL_PATH=/models/detectron2/publaynet_faster_rcnn_R_50_FPN_3x.pth

  # 2. RAG Core Service Override
  rag_core:
    build:
      context: .
      dockerfile: services/rag_core/Dockerfile.offline
    # No volumes needed for models anymore
    environment:
      - TRANSFORMERS_OFFLINE=1
      # Note: We bake models to /models/huggingface/all-MiniLM-L6-v2
      - EMBEDDING_MODEL_PATH=/models/huggingface/all-MiniLM-L6-v2

  # 3. Vision Service Override
  vision:
    build:
      context: .
      dockerfile: services/vision/Dockerfile.offline
    # No volumes needed for models anymore
    environment:
      - WHISPER_MODEL_PATH=/models/whisper/medium.pt
